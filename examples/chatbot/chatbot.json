{
  "context": {
    "aiResponse": null,
    "error": null,
    "followUpQuestion": null,
    "identifiedService": null,
    "providerTypePrompt": null,
    "question": null,
    "questionHistory": [],
    "redefinedPrompt": "Your request included content that raised safety concerns. Please consider rephrasing and try again.",
    "safteyCheck": null,
    "serviceProviders": null,
    "userProblem": null,
    "userSelection": "no",
    "zipCode": null,
    "zipCodePrompt": null
  },
  "id": "chatbot",
  "initial": "userStatesProblem",
  "on": {
    "searchProviders": [
      {
        "actions": [
          {
            "type": "setProviderTypePrompt"
          }
        ],
        "description": "This event is triggered when the user will enter /provider in the chatbot prompt",
        "reenter": true,
        "target": ".PromptUserForProviderType"
      }
    ]
  },
  "states": {
    "DIY": {
      "description": "\n            DIY - Do it yourself Invoke an API to get DIY instructions\n            We pass the userProblem and validate flag to the actor.\n            If response is a safteyBlock,transition to Redefine_user_prompt state.\n            If response is not a safteyBlock, transition to DisplayDIYInstructions state.\n            ",
      "invoke": {
        "id": "fetchInstructionsForDIY",
        "input": {},
        "onDone": [
          {
            "actions": [
              {
                "type": "logEventOutput"
              }
            ],
            "description": "If a safteyBlock is detected then the user is reprompted asking to rephrase his question",
            "guard": "safetyBlockDetected",
            "reenter": true,
            "target": "Redefine_user_prompt"
          },
          {
            "actions": [
              {
                "type": "captureAIResponseAction"
              },
              {
                "type": "logEventOutput"
              }
            ],
            "description": "If no safteyBlock is detected then the user is shown the DIY instructions",
            "guard": "noSafetyBlock",
            "target": "DisplayDIYInstructions"
          }
        ],
        "onError": [
          {
            "actions": [
              {
                "type": "inline:chatbot.DIY#error.platform.fetchInstructionsForDIY[-1]#transition[0]"
              }
            ],
            "reenter": true,
            "target": "Redefine_user_prompt"
          }
        ],
        "src": "fetchInstructionsForDIY"
      }
    },
    "DisplayDIYInstructions": {
      "description": "This state is processed in the useeffect with the AIResponse widget. After displaying, ask if user wants to drill deeper into DIY or look for a provider.",
      "on": {
        "RepromptUserProblem": [
          {
            "actions": [
              {
                "type": "captureUserProblemAction"
              },
              {
                "type": "logEventValue"
              }
            ],
            "description": "Capture the reprompted input. Save it in the context. Then forward and invoke the DIY state",
            "reenter": true,
            "target": "DIY"
          }
        ],
        "drillDeeperDIY": [
          {
            "actions": [],
            "description": "User wants to drill deeper into DIY instructions",
            "target": "DIY"
          }
        ],
        "lookForProvider": [
          {
            "actions": [],
            "description": "User wants to look for a provider (job creation flow)",
            "target": "LaunchCreateJobFunction"
          }
        ]
      }
    },
    "DisplayServiceProviders": {
      "on": {
        "RepromptUserProblem": [
          {
            "actions": [
              {
                "type": "captureUserProblemAction"
              },
              {
                "type": "logEventValue"
              }
            ],
            "description": "Capture the reprompted input. Save it in the context. Then forward and invoke the DIY state",
            "meta": {},
            "reenter": true,
            "target": "DIY"
          }
        ]
      }
    },
    "FetchServiceProviders": {
      "invoke": {
        "id": "fetchProvidersActor",
        "input": {},
        "onDone": [
          {
            "actions": [
              {
                "type": "setServiceProviders"
              },
              {
                "type": "logEventOutput"
              }
            ],
            "reenter": true,
            "target": "DisplayServiceProviders"
          }
        ],
        "src": "fetchProvidersActor"
      },
      "on": {
        "selectProvider": [
          {
            "actions": [],
            "target": "GetSelectedProviderDetails"
          }
        ]
      }
    },
    "GetSelectedProviderDetails": {},
    "LaunchCreateJobFunction": {
      "description": "Navigate users to the 'create job' page",
      "on": {
        "RepromptUserProblem": [
          {
            "actions": [
              {
                "type": "captureUserProblemAction"
              },
              {
                "type": "logEventValue"
              }
            ],
            "description": "Capture the reprompted input. Save it in the context. Then forward and invoke the DIY state",
            "reenter": true,
            "target": "DIY"
          }
        ]
      }
    },
    "PromptUserForProviderType": {
      "description": "States are used for display and transitions for state machine updates. This change in state fires the useEffect. The user will be prompted to enter the provider type. The data he enters is saved in the context and an event is triggered to capture the zip",
      "on": {
        "captureProviderType": [
          {
            "actions": [
              {
                "type": "setProviderType"
              }
            ],
            "target": "PromptUserForZipCode"
          }
        ]
      }
    },
    "PromptUserForZipCode": {
      "description": "If this state is active, we need to ask the user to provide the provider type and the zip code.",
      "entry": {
        "type": "setZipCodePrompt"
      },
      "on": {
        "captureUserZipCode": [
          {
            "actions": [
              {
                "type": "setZipCode"
              },
              {
                "type": "logEventValue"
              }
            ],
            "target": "FetchServiceProviders"
          }
        ]
      }
    },
    "Redefine_user_prompt": {
      "description": "Inform user to rephrase his question",
      "entry": [
        {
          "type": "inline:chatbot.Redefine_user_prompt#entry[0]"
        },
        {
          "type": "inline:chatbot.Redefine_user_prompt#entry[1]"
        }
      ],
      "on": {
        "ResubmitUserRequest": [
          {
            "actions": [
              {
                "type": "captureUserProblemAction"
              },
              {
                "type": "logEventValue"
              }
            ],
            "description": "Capture the new user input. Save it in the context. Then forward and invoke the DIY state",
            "target": "DIY"
          }
        ]
      }
    },
    "userStatesProblem": {
      "on": {
        "captureUserProblem": [
          {
            "actions": [
              {
                "type": "captureUserProblemAction"
              },
              {
                "type": "inline:chatbot.userStatesProblem#captureUserProblem[-1]#transition[1]"
              }
            ],
            "reenter": true,
            "target": "DIY"
          }
        ]
      }
    }
  }
}
